name: CI

on: [push]

env:
   tag: dev-${{ github.sha }} 

jobs:
  development-build:
    runs-on: ubuntu-latest
    steps:
    - name: Verifying Docker Credentials
      uses: actions-hub/docker/login@master
      env:
        DOCKER_USERNAME: ${{ secrets.DOCKER_USER }}
        DOCKER_PASSWORD: ${{ secrets.DOCKER_PASS }}
    
    - uses: actions/checkout@v2
    - name: Build Docker Image
      run: |
        docker build -t ${{ secrets.DOCKER_USER }}/eg.identity.management:${{ env.tag }} -f ./deployment/Dockerfile .

    - name: Publish Docker Image
      run: |
        echo ${{ secrets.DOCKER_PASS }} | docker login --username ${{ secrets.DOCKER_USER }} --password-stdin
        docker push ${{ secrets.DOCKER_USER }}/eg.identity.management:${{ env.tag }}